# Day 4: MasterClass

- Video: Getting to know the K6 for load testing
- Video: How to configure a VU (concurrent users) ramp in your load tests in the k6 tool?
- Video: Learning how to use the K6 HTML Report Exporter in your load tests
- Video: Learning how to use options in your load tests - k6
- Video: Building a Load Testing Pipeline with k6 on the Azure DevOps Platform
- Video: HOW TO DO LOAD AND PERFORMANCE TESTS WITH K6?

## Getting to know the K6 for load testing

**What is Load Testing?**

Performance test that evaluates the behavior of a system under a specific workload.

**What is k6?**

k6 is an open source, command-line tool for load and performance testing, known for its high performance, low resource consumption and integration with various monitoring tools.

**k6 Tool Use Cases**

- **Load Tests**
- **Stress Tests**
- **Spike Tests**
- **Soak Tests**
- **Smoke Tests**
- **Performance Regression Testing**
- **Capacity Tests**

**Practical Example of Load Test Implementation in k6**

1. **Import Module:** Imports the k6 `http` module to make HTTP requests.
2. **Set Options:**
    - `vus` : Defines the number of simultaneous virtual users
    - `duration` : Sets the duration of the test
3. **Main Function:**
    - `http.get()` : Makes a GET request to the specified website.

**Test Execution:**

Save the code in a .js file and run the following command in the terminal:

`k6 run teste.js`

k6 will run the test and display the results in the console, including response time, request rate, errors, etc.

## Configuring VU Ramp in Load Tests with k6

**What is a VU Ramp?**

A Virtual User ramp is a strategy that allows you to gradually increase or decrease the number of virtual users accessing the system during testing. Instead of starting all VUs at once, the ramp simulates a gradual increase in traffic.

**Creating a Load Testing Project Configuration File**

Although k6 allows you to configure VU ramping directly in the test script, a best practice is to create a separate configuration file. This makes it easier to organize and reuse configurations across different tests.

You can create a configuration file with the `.json` extension and define the test options, including the VU ramp.

**Configuring a VU Ramp in Load Tests**

1. **Using `stages` :**
    - In the configuration file or directly in the test script, define an array of objects with the ramp steps:
        - `duration` : Duration of each stage.
        - `target` : Number of VUs desired at the end of each stage.
2. **Using `ramping-vus` :**
    - This option allows you to define different types of ramps and control the waiting time between steps.

## K6 HTML Report Exporter

It is an extension that allows you to generate detailed reports in HTML format after running your load tests. These reports make it easier to analyze the results, presenting graphs, tables and relevant information about the performance of the tested system.

**Report Contents:**

The generated HTML report includes information such as:

- **Executive Summary:** Overview of the test, including date, duration, number of VUs, etc.
- **Metrics:** Graphs and tables with the main metrics collected during the test (response time, throughput, error rate, etc.).
- **Checks:** Result of custom checks defined in the test script.
- **Thresholds:** Indication of which limits were reached or exceeded during the test.
- **Logs:** Log messages generated by k6 during test execution.

## Mastering Options in Your Load Tests with K6

They allow you to customize and control the execution of your load tests. They define everything from the number of virtual users to the way metrics are collected and thresholds are evaluated.

**Basic Structure:**

Options are defined in a JavaScript object within your test script.

**Main Options:**

- **`vus` :** Number of virtual users (VUs) that will run the test simultaneously.
- **`duration` :** Total duration of the test.
- **`iterations` :** Total number of iterations each VU should execute.
- **`stages` :** Defines a ramp of VUs, controlling the gradual increase and decrease of load over time.
- **`thresholds` :** Defines acceptable limits for the metrics. The test fails if the limits are exceeded.
- **`ext` :** Allows you to add extensions to k6 for extra functionality.
- **`tags` :** Add tags to your test results for easier organization and analysis.

## Building a Load Testing Pipeline with k6 on Azure DevOps

Creating a load testing pipeline with k6 in Azure DevOps allows you to automate the execution of your tests at each stage of development, ensuring the quality and performance of your software.

## **How to Perform Load and Performance Testing with k6**

**1. Installation:**

- Download and install k6 according to your operating system: https://k6.io/docs/getting-started/installation/

**2. Creating the Test Script:**

- Write a JavaScript script using the k6 API.
- Define the target, the number of virtual users ( `vus` ), the test duration ( `duration` ) or the number of iterations ( `iterations` ).
- Use the `http` module to make HTTP requests (GET, POST, etc.).
- Use `check` to validate server responses.
- Use `group` to group requests into logical transactions.
- Use `sleep` to simulate the user's thinking time between actions.

**3. Test Execution:**

- Run the script using the command: `k6 run script.js`
- k6 will display the results on the console in real time.

**4. Analysis of Results:**

- k6 generates metrics such as response time, throughput (requests per second), error rate, etc.
- Identify performance bottlenecks, errors and areas for improvement in your system.